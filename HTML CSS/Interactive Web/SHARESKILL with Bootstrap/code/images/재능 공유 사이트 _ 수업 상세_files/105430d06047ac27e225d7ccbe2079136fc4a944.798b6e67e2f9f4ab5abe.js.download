(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{EWj0:function(t,e,n){t.exports=n("ugx8").version},RNCl:function(t,e){var n=function(){if("object"===typeof self&&self)return self;if("object"===typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};t.exports=function(){if(this)return this;if("object"===typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(t){return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}()},d71D:function(t,e,n){"use strict";var i,o,r,a,c,s,u,l,b,f,p,h,d,g,j,O,w,y,m=n("KQm4"),v=n("o0o1"),k=n.n(v),C=n("a3ss"),N=n("1OyB"),x=n("vuIU"),I=n("Y65e"),z=(n("+JCI"),n("2vnA")),A=n("vDqi"),L=n.n(A),_=n("/yzB"),E=n("cBaE"),S=n("fjyx"),T=n.n(S),q=(y=w=function(){function t(){Object(N.a)(this,t),Object(C.a)(this,"socket",o,this),Object(C.a)(this,"isLoading",r,this),Object(C.a)(this,"notificationList",a,this),Object(C.a)(this,"isError",c,this),Object(C.a)(this,"isEnd",s,this),Object(C.a)(this,"isInit",u,this),Object(C.a)(this,"offset",l,this),Object(C.a)(this,"count",b,this),Object(C.a)(this,"connectSocket",f,this),Object(C.a)(this,"fetchNotification",p,this),Object(C.a)(this,"fetchCnt",h,this),Object(C.a)(this,"readItem",d,this),Object(C.a)(this,"deleteNotification",g,this),Object(C.a)(this,"deleteAll",j,this),Object(C.a)(this,"resetOption",O,this)}return Object(x.a)(t,[{key:"notificationCount",get:function(){return this.count}}],[{key:"getInstance",value:function(){return null===t.instance&&(t.instance=new t),t.instance}}]),t}(),w.instance=null,i=y,o=Object(I.a)(i.prototype,"socket",[z.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r=Object(I.a)(i.prototype,"isLoading",[z.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),a=Object(I.a)(i.prototype,"notificationList",[z.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),c=Object(I.a)(i.prototype,"isError",[z.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),s=Object(I.a)(i.prototype,"isEnd",[z.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u=Object(I.a)(i.prototype,"isInit",[z.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),l=Object(I.a)(i.prototype,"offset",[z.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),b=Object(I.a)(i.prototype,"count",[z.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f=Object(I.a)(i.prototype,"connectSocket",[z.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){t.socket=new T.a.w3cwebsocket("wss://api-release.codeit.kr/notifications"),t.socket.onopen=function(){Object(E.b)("connected")},t.socket.onmessage=function(t){Object(E.b)("connectSocket onmessage",t)},t.socket.onclose=function(t){Object(E.b)("connectSocket onclose",t),Object(E.b)("disconnected")}}}}),p=Object(I.a)(i.prototype,"fetchNotification",[z.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){var e,n,i,o;return k.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(t.isLoading||t.isError||t.isEnd)){r.next=2;break}return r.abrupt("return");case 2:return t.isLoading=!0,r.prev=3,r.next=6,k.a.awrap(L()({method:"post",url:"https://api.codeit.kr/graphql",headers:{"Content-Type":"application/graphql",Authorization:"Bearer "+Object(E.j)("cat")},data:"\n          {\n            notificationsWithOffset(offset: "+t.offset+", limit: 10, includeRead: false) {\n              "+_.a.NOTIFICATION_ATTR()+"\n            }\n            unreadNotificationsCount\n          }\n        "}));case 6:e=r.sent,n=!!e.data.errors.length,i=!!e.data.data.notificationsWithOffset.length,o=!!e.data.data.unreadNotificationsCount,!n||i||o?setTimeout((function(){Object(z.runInAction)((function(){t.isLoading=!1,t.notificationList=t.notificationList.concat(e.data.data.notificationsWithOffset),t.offset+=t.notificationList.length,t.count=e.data.data.unreadNotificationsCount,t.isInit||(t.isInit=!0)}))}),800):Object(z.runInAction)((function(){t.isError=!0})),e.data.data.notificationsWithOffset.length<10&&Object(z.runInAction)((function(){t.isEnd=!0})),r.next=17;break;case 14:r.prev=14,r.t0=r.catch(3),Object(z.runInAction)((function(){t.isError=!0}));case 17:case"end":return r.stop()}}),null,null,[[3,14]])}}}),h=Object(I.a)(i.prototype,"fetchCnt",[z.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){var e,n,i;return k.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,k.a.awrap(L()({method:"post",url:"https://api.codeit.kr/graphql",headers:{"Content-Type":"application/graphql",Authorization:"Bearer "+Object(E.j)("cat")},data:"\n          {\n            unreadNotificationsCount\n          }\n        "}));case 3:e=o.sent,n=!!e.data.errors.length,i=!!e.data.data.unreadNotificationsCount,n&&!i?Object(z.runInAction)((function(){t.isError=!0})):Object(z.runInAction)((function(){t.count=e.data.data.unreadNotificationsCount})),o.next=12;break;case 9:o.prev=9,o.t0=o.catch(0),Object(z.runInAction)((function(){t.isError=!0}));case 12:case"end":return o.stop()}}),null,null,[[0,9]])}}}),d=Object(I.a)(i.prototype,"readItem",[z.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(e){var n;return k.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(void 0===(n=t.notificationList.find((function(t){return t.id===e})))){i.next=5;break}if(!n.read){i.next=4;break}return i.abrupt("return");case 4:Object(z.runInAction)((function(){n.read=!0,t.count-=1,t.notificationList=Object(m.a)(t.notificationList)}));case 5:return i.next=7,k.a.awrap(L()({method:"post",url:"https://api.codeit.kr/graphql",headers:{"Content-Type":"application/graphql",Authorization:"Bearer "+Object(E.j)("cat")},data:'\n        mutation {\n          readNotification(id: "'+e+'") {\n            id\n          }\n        }\n      '}).then((function(t){Object(E.b)("readItem res",t)})).catch((function(t){Object(E.b)("readItem err",t)})));case 7:case"end":return i.stop()}}))}}}),g=Object(I.a)(i.prototype,"deleteNotification",[z.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(e){return k.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,k.a.awrap(L()({method:"post",url:"https://api.codeit.kr/graphql",headers:{"Content-Type":"application/graphql",Authorization:"Bearer "+Object(E.j)("cat")},data:'\n        mutation {\n          deleteNotification(id: "'+e+'") {\n            id\n          }\n        }\n      '}).then((function(t){Object(E.b)("deleteNotification res",t)})).catch((function(t){Object(E.b)("deleteNotification err",t)})).finally((function(){Object(z.runInAction)((function(){var n=t.notificationList.find((function(t){return t.id===e}));void 0===n||n.read||(t.count-=1,t.offset-=1),t.notificationList=t.notificationList.filter((function(t){return t.id!==e})),0!==t.count&&0===t.notificationList.length&&t.fetchNotification()}))})));case 2:case"end":return n.stop()}}))}}}),j=Object(I.a)(i.prototype,"deleteAll",[z.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){return k.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.notificationList.length){e.next=3;break}return e.next=3,k.a.awrap(L()({method:"post",url:"https://api.codeit.kr/graphql",headers:{"Content-Type":"application/graphql",Authorization:"Bearer "+Object(E.j)("cat")},data:"\n          mutation {\n            deleteAllNotifications {\n              id\n            }\n          }\n        "}).then((function(t){Object(E.b)("deleteAll res",t)})).catch((function(t){Object(E.b)("deleteAll err",t)})).finally((function(){Object(z.runInAction)((function(){t.notificationList=[],t.count=0}))})));case 3:case"end":return e.stop()}}))}}}),O=Object(I.a)(i.prototype,"resetOption",[z.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){t.isInit=!1,t.notificationList=[],t.isError=!1,t.isLoading=!1,t.offset=0,t.isEnd=!1}}}),Object(I.a)(i.prototype,"notificationCount",[z.computed],Object.getOwnPropertyDescriptor(i.prototype,"notificationCount"),i.prototype),i);e.a=q},fjyx:function(t,e,n){var i;try{i=n("RNCl")}catch(c){}finally{if(i||"undefined"===typeof window||(i=window),!i)throw new Error("Could not determine global this")}var o=i.WebSocket||i.MozWebSocket,r=n("EWj0");function a(t,e){return e?new o(t,e):new o(t)}o&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach((function(t){Object.defineProperty(a,t,{get:function(){return o[t]}})})),t.exports={w3cwebsocket:o?a:null,version:r}},ugx8:function(t){t.exports=JSON.parse('{"_args":[["websocket@1.0.31","/home/circleci/project"]],"_from":"websocket@1.0.31","_id":"websocket@1.0.31","_inBundle":false,"_integrity":"sha512-VAouplvGKPiKFDTeCCO65vYHsyay8DqoBSlzIO3fayrfOgU94lQN5a1uWVnFrMLceTJw/+fQXR5PGbUVRaHshQ==","_location":"/websocket","_phantomChildren":{"es6-iterator":"2.0.3","ext":"1.4.0","next-tick":"1.0.0","type":"1.2.0"},"_requested":{"type":"version","registry":true,"raw":"websocket@1.0.31","name":"websocket","escapedName":"websocket","rawSpec":"1.0.31","saveSpec":null,"fetchSpec":"1.0.31"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/websocket/-/websocket-1.0.31.tgz","_spec":"1.0.31","_where":"/home/circleci/project","author":{"name":"Brian McKelvey","email":"theturtle32@gmail.com","url":"https://github.com/theturtle32"},"browser":"lib/browser.js","bugs":{"url":"https://github.com/theturtle32/WebSocket-Node/issues"},"config":{"verbose":false},"contributors":[{"name":"I\xf1aki Baz Castillo","email":"ibc@aliax.net","url":"http://dev.sipdoc.net"}],"dependencies":{"debug":"^2.2.0","es5-ext":"^0.10.50","nan":"^2.14.0","typedarray-to-buffer":"^3.1.5","yaeti":"^0.0.6"},"description":"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.","devDependencies":{"buffer-equal":"^1.0.0","faucet":"^0.0.1","gulp":"^4.0.2","gulp-jshint":"^2.0.4","jshint":"^2.0.0","jshint-stylish":"^2.2.1","tape":"^4.9.1"},"directories":{"lib":"./lib"},"engines":{"node":">=0.10.0"},"homepage":"https://github.com/theturtle32/WebSocket-Node","keywords":["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],"license":"Apache-2.0","main":"index","name":"websocket","repository":{"type":"git","url":"git+https://github.com/theturtle32/WebSocket-Node.git"},"scripts":{"gulp":"gulp","install":"(node-gyp rebuild 2> builderror.log) || (exit 0)","test":"faucet test/unit"},"version":"1.0.31"}')}}]);